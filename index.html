<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <meta name="tarot-build" content="2026-01-31-01">
    <title>Mystic Tarot | 神秘塔罗</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <!-- MediaPipe Hands -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <!-- Markdown Renderer -->
    <script src="https://cdn.jsdelivr.net/npm/marked/lib/marked.umd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <!-- Background Canvas -->
    <canvas id="stars-canvas"></canvas>
    <div id="fog-layer"></div>

    <!-- Entrance Scene (The "Little Room") -->
    <div id="entrance-scene">
        <div class="room-content">
            <div class="mystic-door-container">
                <div class="mystic-door">
                    <div class="door-inner">
                        <div class="eye-symbol">👁</div>
                    </div>
                </div>
                <div class="door-glow"></div>
            </div>
            <div class="entrance-ui">
                <h2 class="mystic-title">神秘占卜室</h2>
                <p class="mystic-subtitle">敲响命运之门，探寻未来启示</p>
                <button id="enter-btn" class="btn" style="display:none">推开房门</button>
            </div>
        </div>

        <!-- Mystic Dialogue Scene -->
        <div id="mystic-dialogue-overlay">
            <div class="dialogue-container">
                <div id="mystic-text-bubble" class="mystic-text"></div>
                <div id="question-options" class="options-grid"></div>
                <div id="custom-question-container" style="display:none; margin-top: 20px;">
                    <input type="text" id="custom-question-input" placeholder="请说出你的困惑..." class="mystic-input">
                    <button id="submit-custom-btn" class="btn">确认为此问题</button>
                </div>
            </div>
        </div>
    </div>

    <div id="asset-loader">
        <div style="font-size: 1.25rem; color: var(--accent-gold); letter-spacing: 2px;">资源加载中 · v2026-01-31-01</div>
        <div id="asset-progress-text" style="color: #ddd; font-size: 0.95rem;">0%</div>
        <div id="asset-progress-container">
            <div id="asset-progress-bar"></div>
        </div>
        <button id="asset-retry-btn" class="btn" style="display:none">重试加载</button>
    </div>

    <!-- UI Layer -->
    <div id="ui-layer">
        <div id="settings-btn">
            <svg viewBox="0 0 24 24" width="24" height="24" fill="currentColor">
                <path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
            </svg>
        </div>
        <div id="hand-cursor"></div>
        <div id="charge-ring"></div>
        <div id="header">
            <div id="status-text">正在启动...</div>
            <div id="charge-progress-container">
                <div id="charge-progress-bar"></div>
            </div>
        </div>

        <div id="picked-zone">
            <div class="picked-slot" id="slot-0"></div>
            <div class="picked-slot" id="slot-1"></div>
            <div class="picked-slot" id="slot-2"></div>
        </div>

        <!-- Token Input Removed -->

        <div id="interaction-guide" style="display:none; position: absolute; top: 70%; left: 50%; transform: translate(-50%, -50%); width: 100%; text-align: center; pointer-events: none; z-index: 1000; opacity: 0; transition: opacity 1s ease;">
            <div style="background: rgba(0,0,0,0.7); display: inline-block; padding: 20px 40px; border-radius: 15px; border: 1px solid var(--accent-gold); backdrop-filter: blur(5px);">
                <div style="color: var(--accent-gold); font-size: 1.1rem; margin-bottom: 15px; letter-spacing: 2px;">控制指南</div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; color: #ccc; font-size: 0.9rem;">
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 1.5rem;">✋</span>
                        <span>挥手滑动 / 握拳选牌</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 1.5rem;">🖱️</span>
                        <span>拖拽滑动 / 点击选牌</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <span style="font-size: 1.5rem;">⌨️</span>
                        <span>方向键滑动 / 空格选牌</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="controls">
            <button id="start-btn" class="btn" style="display:none">开始体验</button>
            <button id="interpret-btn" class="btn" style="display:none; background: linear-gradient(45deg, #d4af37, #f0e68c); color: #000; font-weight: bold; box-shadow: 0 0 20px rgba(212,175,55,0.6);">解读</button>
            <div class="spinner" id="loading-spinner"></div>
        </div>
    </div>

    <video id="webcam-preview" playsinline></video>

    <!-- 3D Scene -->
    <div id="game-container">
        <div id="scene">
            <!-- Cards will be injected here -->
        </div>
        <div id="ritual-hint" class="ritual-hint"></div>
    </div>

    <!-- Inline Interpretation Content -->
    <div id="interpretation-inline" class="interpretation-inline">
        <div id="interpretation-content"></div>
        <div id="post-interpretation-actions" style="display:none; text-align:center; margin-top:50px;">
            <button id="reset-btn" class="btn" style="background: rgba(212,175,55,0.15); border-color: var(--accent-gold); box-shadow: 0 0 15px var(--accent-glow);">✨ 再次提问</button>
        </div>
    </div>


    <!-- Settings Modal -->
    <div id="settings-modal">
        <div class="settings-content">
            <h2 style="color: var(--accent-gold);">API Key 配置 （本地存储）</h2>
            <p>请输入您的 DeepSeek API Key 以开启 AI 解读功能。</p>
            <p style="font-size: 0.9rem; color: #aaa;">
                还没有 Key？前往 <a href="https://platform.deepseek.com/api_keys" target="_blank">DeepSeek Platform</a> 获取。
            </p>
            <input type="password" id="api-token-input" placeholder="sk-...">
            <div id="token-status" style="font-size: 0.8rem; margin: 10px 0; min-height: 1.2em;"></div>
            <button id="save-settings-btn" class="btn">保存配置</button>
            <button id="close-settings-btn" class="btn" style="background: transparent; border: 1px solid #444; margin-top: 10px;">关闭</button>
        </div>
    </div>
    <script src="script.js"></script>
</body>
</html>
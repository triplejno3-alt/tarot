# 塔罗牌游戏设计文档

## 一、项目概述
本项目是一个单 HTML 文件的塔罗牌游戏，提供神秘、酷炫的 3D 视觉体验与手势交互。玩家通过摄像头手势左右滑动牌阵并选择中间牌，完成三张牌的抽取后进入解读阶段。若配置硅基流动 deepseek-ai/DeepSeek-V3.2 Token，则生成 AI 解读；未配置时仅展示牌面与基础含义。

## 二、目标与非目标
### 目标
- 单 HTML 文件即可运行
- 三张牌抽取与解读流程符合塔罗规则
- 3D 视觉效果、神秘氛围、酷炫动画
- 专业塔罗牌正面图
- 牌阵横向排列
- 摄像头手势控制牌阵滑动与选牌
- 集成 deepseek-ai/DeepSeek-V3.2 解读能力

### 非目标
- 多人对战或社交功能
- 后端服务部署
- 多语言支持

## 三、用户体验与流程
1. 进入页面，展示 3D 牌阵横向摆放，背景有雾化与光晕效果  
2. 用户允许摄像头权限后，看到手势指引  
3. 左右挥手控制牌阵滑动  
4. 手向上抬起触发选中中间牌  
5. 依次选满 3 张牌后，展示翻牌动画与最终牌面  
6. 若设置 Token，则请求 AI 解读并展示详细解读  

## 四、核心玩法规则
### 牌数与阵型
- 固定抽取 3 张牌
- 牌阵横向排列，依序代表：过去、现在、未来

### 选牌逻辑
- 牌阵中始终只有中间牌处于可选状态
- 每次手向上动作触发选中当前中间牌
- 选中后牌阵自动调整，保持可选中间牌位置

## 五、视觉与交互设计
### 视觉风格
- 背景：暗色渐变 + 轻微动态雾效  
- 光效：中心聚光与卡牌边缘发光  
- 音效：翻牌、选牌时可选静音  

### 3D 效果
- 使用 CSS 3D + 透视矩阵实现牌阵立体感  
- 翻牌动画使用 3D rotateY  
- 牌阵滑动带轻微 Z 轴浮动与 parallax  

### 卡牌材质
- 正面：使用 https://sacred-texts.com/tarot/pkt/ 页面中的专业塔罗牌图像  
- 背面：统一神秘花纹  

## 六、技术方案
### 单 HTML 文件
所有 CSS 与 JS 内联在单个 HTML 文件中，资源按需通过 CDN 加载：
- 手势识别：MediaPipe Hands CDN  
- 可选 3D 库：纯 CSS 3D，不依赖三方 3D 引擎  

### 核心模块划分
1. 卡牌数据模块  
2. 3D 牌阵渲染模块  
3. 手势识别模块  
4. 游戏状态机模块  
5. AI 解读模块  
6. UI 反馈模块  

## 七、数据结构设计
### 牌数据
- id  
- name  
- arcanaType（大阿尔卡那/小阿尔卡那）  
- uprightMeaning  
- reversedMeaning  
- imageUrl  

### 游戏状态
- deck  
- pickedCards（数组，最多 3 张）  
- currentIndex（牌阵中心索引）  
- stage（idle / picking / reveal / interpretation）  
- apiToken  

## 八、手势识别
### 目标手势
- 左右滑动：手掌中心横向移动超过阈值  
- 向上选牌：手掌中心纵向上移超过阈值  

### 实现流程
1. 摄像头捕获视频流  
2. MediaPipe Hands 实时识别手部关键点  
3. 计算手掌中心坐标  
4. 对比上一帧坐标判断方向  
5. 触发滑动或选牌事件  

### 交互约束
- 防抖与冷却时间防止误触  
- 同一时间只识别一只手  

## 九、AI 解读模块
### 触发条件
- 选满 3 张牌  
- Token 已配置  

### 解读请求
- 模型：deepseek-ai/DeepSeek-V3.2  
- 输入：牌名 + 正逆位 + 位置（过去/现在/未来）  
- 输出：整体解读 + 分项解读  

### Token 处理
- UI 提供 token 输入框  
- 未配置时仅展示牌面与基础含义  
- Token 仅保存在内存，不写入本地存储  

## 十、安全与隐私
- 摄像头仅本地使用，不上传视频  
- Token 仅用于调用 API，不写入文件  
- 明确提示用户可随时关闭摄像头  

## 十一、性能与兼容性
- 目标设备：现代桌面浏览器  
- FPS 保持在 30+  
- 支持 WebGL 不依赖  

## 十二、测试与验证
- 手势控制可靠性测试  
- 牌阵滑动与选牌动画测试  
- Token 为空时解读不展示  
- AI 解读展示与排版一致性验证  

## 十三、里程碑
1. 单 HTML 原型完成  
2. 3D 视觉优化  
3. 手势识别稳定  
4. AI 解读接入  
5. 整体验收  
